{
  "services": [{
    "cluster": "datacamp-services",
    "servicePort": 1337,
    "serviceName": "rdoc-app",
    "serviceProtocol": "HTTP",
    "desiredCount": 1,
    "loadBalancer": "datacamp-rdocumentation",
    "containers": [
      {
        "containerName": "rdoc-app",
        "containerImage": "rdoc-app",
        "containerTag": "${CIRCLE_SHA1}",
        "containerPort": 1337,
        "memoryReservation": 256,
        "essential": true,
        "healthCheck": {
          "command": [
            "CMD-SHELL",
            "curl -f http://localhost:1337/status || exit 1"
          ],
          "interval": 60,
          "startPeriod": 120
        },
        "dockerLabels": {
          "com.datadoghq.ad.instances": "[{ \"name\": \"service_check\", \"url\": \"http://%%host%%:%%port%%/status\", \"tags\": [\"service:rdoc-app\"], \"allow_redirects\": false }]",
          "com.datadoghq.ad.check_names": "[\"http_check\"]",
          "com.datadoghq.ad.init_configs": "[{}]"
        }
      }
    ]
  },
  {
    "cluster": "datacamp-services",
    "serviceName": "rdoc-app-worker",
    "servicePort": 1337,
    "serviceProtocol": "HTTP",
    "desiredCount": 1,
    "loadBalancer": "datacamp-services-internal",
    "containers": [
      {
        "containerName": "rdoc-app-worker",
        "containerImage": "rdoc-app",
        "containerTag": "${CIRCLE_SHA1}",
        "containerPort": 1337,
        "memoryReservation": 4000,
        "cpu": 256,
        "essential": true
      },
      {
        "containerName": "rdoc-app-sqsd",
        "containerImage": "sqsd",
        "containerTag": "latest",
        "memoryReservation": 128,
        "essential": true,
        "containerCommand": [
          "bash",
          "-c",
          "eval $(aws-env) && node run-cli.js"
        ]
      }
    ]
  }]
}